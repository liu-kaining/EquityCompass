{% extends "base.html" %}

{% block title %}æ·»åŠ è‡ªå®šä¹‰è‚¡ç¥¨ - æ™ºç­–è‚¡æ{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h1 class="gradient-text mb-2">
                    <i class="fas fa-plus-circle me-3"></i>æ·»åŠ è‡ªå®šä¹‰è‚¡ç¥¨
                </h1>
                <p class="text-muted fs-5">æ·»åŠ æ‚¨å…³æ³¨çš„è‚¡ç¥¨åˆ°ç³»ç»Ÿä¸­ï¼Œä¸°å¯Œè‚¡ç¥¨æ± æ•°æ®</p>
            </div>
            <div>
                <a href="{{ url_for('stocks.index') }}" class="btn btn-outline-primary btn-lg">
                    <i class="fas fa-arrow-left me-2"></i>è¿”å›è‚¡ç¥¨æ± 
                </a>
            </div>
        </div>
    </div>
</div>

<div class="row justify-content-center">
    <div class="col-lg-8">
        <!-- ä¸»è¦è¡¨å•å¡ç‰‡ -->
        <div class="card glass-effect shadow-lg border-0">
            <div class="card-header bg-gradient-primary text-white py-3">
                <h5 class="card-title mb-0">
                    <i class="fas fa-edit me-2"></i>è‚¡ç¥¨ä¿¡æ¯
                </h5>
            </div>
            <div class="card-body p-4">
                <form method="POST" id="addStockForm">
                    <!-- è‚¡ç¥¨ä»£ç å’Œå¸‚åœº -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="form-floating">
                                <input type="text" class="form-control form-control-lg" 
                                       id="code" name="code" required 
                                       placeholder="ä¾‹å¦‚: AAPL, 00700.HK"
                                       pattern="[A-Za-z0-9.]+"
                                       title="è¯·è¾“å…¥æœ‰æ•ˆçš„è‚¡ç¥¨ä»£ç ">
                                <label for="code">
                                    <i class="fas fa-tag me-2"></i>è‚¡ç¥¨ä»£ç  <span class="text-danger">*</span>
                                </label>
                            </div>
                            <div class="form-text mt-2">
                                <i class="fas fa-info-circle me-1"></i>
                                ç¾è‚¡ï¼šAAPL, MSFT, GOOGL<br>
                                æ¸¯è‚¡ï¼š00700.HK, 09988.HK
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="custom-select market-select">
                                <select class="form-select form-select-lg" 
                                        id="market" name="market" required>
                                    <option value="">è¯·é€‰æ‹©å¸‚åœº</option>
                                    <option value="US">ğŸ‡ºğŸ‡¸ ç¾è‚¡ (NASDAQ/NYSE)</option>
                                    <option value="HK">ğŸ‡­ğŸ‡° æ¸¯è‚¡ (HKEX)</option>
                                </select>
                            </div>
                            <div class="form-text mt-2">
                                <i class="fas fa-info-circle me-1"></i>
                                é€‰æ‹©è‚¡ç¥¨æ‰€å±çš„å¸‚åœº
                            </div>
                            <div class="form-text mt-2">
                                <i class="fas fa-info-circle me-1"></i>
                                é€‰æ‹©è‚¡ç¥¨æ‰€å±çš„å¸‚åœº
                            </div>
                        </div>
                    </div>
                    
                    <!-- å…¬å¸åç§° -->
                    <div class="mb-4">
                        <div class="form-floating">
                            <input type="text" class="form-control form-control-lg" 
                                   id="name" name="name" required 
                                   placeholder="ä¾‹å¦‚: è‹¹æœå…¬å¸, è…¾è®¯æ§è‚¡æœ‰é™å…¬å¸">
                            <label for="name">
                                <i class="fas fa-building me-2"></i>å…¬å¸åç§° <span class="text-danger">*</span>
                            </label>
                        </div>
                        <div class="form-text mt-2">
                            <i class="fas fa-info-circle me-1"></i>
                            è¯·è¾“å…¥å…¬å¸çš„å®Œæ•´åç§°
                        </div>
                    </div>
                    
                    <!-- è¡Œä¸šå’Œäº¤æ˜“æ‰€ -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="form-floating">
                                <input type="text" class="form-control form-control-lg" 
                                       id="industry" name="industry" 
                                       placeholder="ä¾‹å¦‚: ç§‘æŠ€, é‡‘è, æ¶ˆè´¹">
                                <label for="industry">
                                    <i class="fas fa-industry me-2"></i>è¡Œä¸š
                                </label>
                            </div>
                            <div class="form-text mt-2">
                                <i class="fas fa-info-circle me-1"></i>
                                å¯é€‰ï¼šå…¬å¸æ‰€å±è¡Œä¸š
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="form-floating">
                                <input type="text" class="form-control form-control-lg" 
                                       id="exchange" name="exchange" 
                                       placeholder="ä¾‹å¦‚: NASDAQ, NYSE, HKEX">
                                <label for="exchange">
                                    <i class="fas fa-exchange-alt me-2"></i>äº¤æ˜“æ‰€
                                </label>
                            </div>
                            <div class="form-text mt-2">
                                <i class="fas fa-info-circle me-1"></i>
                                å¯é€‰ï¼šå…·ä½“çš„äº¤æ˜“æ‰€
                            </div>
                        </div>
                    </div>
                    
                    <!-- æç¤ºä¿¡æ¯ -->
                    <div class="alert alert-info border-0 shadow-sm">
                        <div class="d-flex align-items-start">
                            <i class="fas fa-lightbulb text-warning fs-4 me-3 mt-1"></i>
                            <div>
                                <h6 class="alert-heading mb-2">æ·»åŠ æç¤º</h6>
                                <ul class="mb-0 ps-3">
                                    <li>è‚¡ç¥¨ä»£ç å°†è‡ªåŠ¨è½¬æ¢ä¸ºå¤§å†™æ ¼å¼</li>
                                    <li>æ·»åŠ çš„è‚¡ç¥¨å°†å‡ºç°åœ¨è‚¡ç¥¨æ± ä¸­ï¼Œå…¶ä»–ç”¨æˆ·ä¹Ÿå¯ä»¥çœ‹åˆ°</li>
                                    <li>è¯·ç¡®ä¿è‚¡ç¥¨ä»£ç çš„å‡†ç¡®æ€§ï¼Œé¿å…é‡å¤æ·»åŠ </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ“ä½œæŒ‰é’® -->
                    <div class="d-flex justify-content-between pt-3">
                        <a href="{{ url_for('stocks.index') }}" class="btn btn-outline-secondary btn-lg">
                            <i class="fas fa-times me-2"></i>å–æ¶ˆ
                        </a>
                        <button type="submit" class="btn btn-success btn-lg px-4">
                            <i class="fas fa-plus me-2"></i>æ·»åŠ è‚¡ç¥¨
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- å¿«é€Ÿæ·»åŠ ç¤ºä¾‹ -->
        <div class="card glass-effect shadow-lg border-0 mt-4">
            <div class="card-header bg-gradient-info text-white py-3">
                <h5 class="card-title mb-0">
                    <i class="fas fa-lightbulb me-2"></i>å¿«é€Ÿæ·»åŠ ç¤ºä¾‹
                </h5>
            </div>
            <div class="card-body p-4">
                <div class="row">
                    <div class="col-md-6">
                        <div class="d-flex align-items-center mb-3">
                            <i class="fas fa-flag-usa text-primary fs-4 me-2"></i>
                            <h6 class="mb-0 text-primary fw-bold">ç¾è‚¡ç¤ºä¾‹</h6>
                        </div>
                        <div class="list-group list-group-flush">
                            <div class="list-group-item bg-transparent border-0 ps-0">
                                <div class="d-flex align-items-center">
                                    <span class="badge bg-primary me-2">AAPL</span>
                                    <span>è‹¹æœå…¬å¸</span>
                                    <small class="text-muted ms-auto">ç§‘æŠ€</small>
                                </div>
                            </div>
                            <div class="list-group-item bg-transparent border-0 ps-0">
                                <div class="d-flex align-items-center">
                                    <span class="badge bg-primary me-2">MSFT</span>
                                    <span>å¾®è½¯å…¬å¸</span>
                                    <small class="text-muted ms-auto">ç§‘æŠ€</small>
                                </div>
                            </div>
                            <div class="list-group-item bg-transparent border-0 ps-0">
                                <div class="d-flex align-items-center">
                                    <span class="badge bg-primary me-2">GOOGL</span>
                                    <span>è°·æ­Œ</span>
                                    <small class="text-muted ms-auto">ç§‘æŠ€</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="d-flex align-items-center mb-3">
                            <i class="fas fa-flag text-success fs-4 me-2"></i>
                            <h6 class="mb-0 text-success fw-bold">æ¸¯è‚¡ç¤ºä¾‹</h6>
                        </div>
                        <div class="list-group list-group-flush">
                            <div class="list-group-item bg-transparent border-0 ps-0">
                                <div class="d-flex align-items-center">
                                    <span class="badge bg-success me-2">00700.HK</span>
                                    <span>è…¾è®¯æ§è‚¡</span>
                                    <small class="text-muted ms-auto">ç§‘æŠ€</small>
                                </div>
                            </div>
                            <div class="list-group-item bg-transparent border-0 ps-0">
                                <div class="d-flex align-items-center">
                                    <span class="badge bg-success me-2">09988.HK</span>
                                    <span>é˜¿é‡Œå·´å·´</span>
                                    <small class="text-muted ms-auto">ç§‘æŠ€</small>
                                </div>
                            </div>
                            <div class="list-group-item bg-transparent border-0 ps-0">
                                <div class="d-flex align-items-center">
                                    <span class="badge bg-success me-2">03690.HK</span>
                                    <span>ç¾å›¢</span>
                                    <small class="text-muted ms-auto">æ¶ˆè´¹</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<!-- Font Awesome -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<style>
.form-floating > .form-control:focus,
.form-floating > .form-select:focus {
    border-color: #0d6efd;
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
}

.form-floating > .form-control-lg {
    height: calc(3.5rem + 2px);
    line-height: 1.25;
}

.form-floating > .form-select-lg {
    height: calc(3.5rem + 2px);
    line-height: 1.25;
}

.bg-gradient-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.bg-gradient-info {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
}

.card.glass-effect {
    backdrop-filter: blur(10px);
    background: rgba(255, 255, 255, 0.95);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.shadow-lg {
    box-shadow: 0 1rem 3rem rgba(0, 0, 0, 0.175) !important;
}
</style>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // è¡¨å•éªŒè¯
    $('#addStockForm').submit(function(e) {
        const code = $('#code').val().trim().toUpperCase();
        const name = $('#name').val().trim();
        const market = $('#market').val();
        
        // åŸºæœ¬éªŒè¯
        if (!code || !name || !market) {
            e.preventDefault();
            showToast('error', 'è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ');
            return false;
        }
        
        // è‚¡ç¥¨ä»£ç æ ¼å¼éªŒè¯
        if (!/^[A-Z0-9.]+$/.test(code)) {
            e.preventDefault();
            showToast('error', 'è‚¡ç¥¨ä»£ç æ ¼å¼ä¸æ­£ç¡®');
            return false;
        }
        
        // å¸‚åœºä¸ä»£ç åŒ¹é…éªŒè¯
        if (market === 'HK' && !code.includes('.HK')) {
            if (!confirm('æ¸¯è‚¡ä»£ç é€šå¸¸åŒ…å« .HK åç¼€ï¼Œæ˜¯å¦ç»§ç»­æ·»åŠ ï¼Ÿ')) {
                e.preventDefault();
                return false;
            }
        }
        
        // æ˜¾ç¤ºæäº¤çŠ¶æ€
        const submitBtn = $(this).find('button[type="submit"]');
        submitBtn.prop('disabled', true);
        submitBtn.html('<i class="fas fa-spinner fa-spin me-2"></i>æ·»åŠ ä¸­...');
    });
    
    // è‡ªåŠ¨æ ¼å¼åŒ–è‚¡ç¥¨ä»£ç 
    $('#code').on('input', function() {
        let value = $(this).val().toUpperCase();
        // ç§»é™¤ç‰¹æ®Šå­—ç¬¦ï¼Œåªä¿ç•™å­—æ¯ã€æ•°å­—å’Œç‚¹
        value = value.replace(/[^A-Z0-9.]/g, '');
        $(this).val(value);
    });
    
    // æ ¹æ®å¸‚åœºè‡ªåŠ¨è®¾ç½®äº¤æ˜“æ‰€
    $('#market').change(function() {
        const market = $(this).val();
        if (market === 'US') {
            $('#exchange').val('NASDAQ');
        } else if (market === 'HK') {
            $('#exchange').val('HKEX');
        } else {
            $('#exchange').val('');
        }
    });
    
    // æ˜¾ç¤ºæ¶ˆæ¯æç¤º
    function showToast(type, message) {
        const toastClass = type === 'success' ? 'alert-success' : 'alert-danger';
        const icon = type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle';
        
        const toast = $(`
            <div class="alert ${toastClass} alert-dismissible fade show position-fixed" 
                 style="top: 20px; right: 20px; z-index: 9999; min-width: 300px;">
                <i class="fas ${icon} me-2"></i>
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        `);
        
        $('body').append(toast);
        
        // è‡ªåŠ¨æ¶ˆå¤±
        setTimeout(function() {
            toast.alert('close');
        }, 3000);
    }
});
</script>
{% endblock %}
